name: CI/CD on main branch

on:
  push:
    branches:
      - "main"

jobs:
  cd:
    uses: decentraland/platform-actions/.github/workflows/apps-docker-next.yml@main
    with:
      service-name: notifications-workers
    secrets: inherit

  notifications-inbox-deployment:
    needs: [cd]
    name: "Deploy core to: dev"
    runs-on: ubuntu-latest
    steps:
      - name: Trigger deployment (notifications-inbox)
        id: deploy
        uses: decentraland/dcl-deploy-action@main
        with:
          dockerImage: "quay.io/decentraland/notifications-workers:next"
          serviceName: notifications-inbox
          env: dev
          token: ${{ secrets.GITHUB_TOKEN }}

  notifications-publisher-deployment:
    needs: [cd]
    name: "Deploy publisher to: dev"
    runs-on: ubuntu-latest
    steps:
      - name: Trigger deployment (notifications-publisher)
        id: deploy
        uses: decentraland/dcl-deploy-action@main
        with:
          dockerImage: "quay.io/decentraland/notifications-workers:next"
          serviceName: notifications-publisher
          env: dev
          token: ${{ secrets.GITHUB_TOKEN }}

  notifications-processor-deployment:
    needs: [cd]
    name: "Deploy notifications-stats to: dev"
    runs-on: ubuntu-latest
    steps:
      - name: Trigger deployment (notifications-processor)
        id: deploy
        uses: decentraland/dcl-deploy-action@main
        with:
          dockerImage: "quay.io/decentraland/notifications-workers:next"
          serviceName: notifications-processor
          env: dev
          token: ${{ secrets.GITHUB_TOKEN }}
